<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/images/favicon.png" />
<title>Capturing Hierarchical Data in Plain Text | Bret Alexander Beheim</title>
<meta name="title" content="Capturing Hierarchical Data in Plain Text" />
<meta name="description" content="A practical method of entering structured data into a computer is to type it directly into a text file. Simply fire up your favorite CSV editor1, sit down with your source material and start typing. Unlike boutique database software, this method can be used immediately and with minimal training. In fact, I know several researchers who skip paper forms altogether and do it during their field interviews.
Plaintext data entry works great, unless the data are hierarchical. I’m thinking of one of three situations:" />
<meta name="keywords" content="" />


<meta property="og:url" content="/blog/2017-02-12-hierarchical-data-in-plain-text/">
  <meta property="og:site_name" content="Bret Alexander Beheim">
  <meta property="og:title" content="Capturing Hierarchical Data in Plain Text">
  <meta property="og:description" content="A practical method of entering structured data into a computer is to type it directly into a text file. Simply fire up your favorite CSV editor1, sit down with your source material and start typing. Unlike boutique database software, this method can be used immediately and with minimal training. In fact, I know several researchers who skip paper forms altogether and do it during their field interviews.
Plaintext data entry works great, unless the data are hierarchical. I’m thinking of one of three situations:">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2017-02-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2017-02-12T00:00:00+00:00">
    <meta property="og:image" content="/images/bret-head.jpg">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="/images/bret-head.jpg">
  <meta name="twitter:title" content="Capturing Hierarchical Data in Plain Text">
  <meta name="twitter:description" content="A practical method of entering structured data into a computer is to type it directly into a text file. Simply fire up your favorite CSV editor1, sit down with your source material and start typing. Unlike boutique database software, this method can be used immediately and with minimal training. In fact, I know several researchers who skip paper forms altogether and do it during their field interviews.
Plaintext data entry works great, unless the data are hierarchical. I’m thinking of one of three situations:">




  <meta itemprop="name" content="Capturing Hierarchical Data in Plain Text">
  <meta itemprop="description" content="A practical method of entering structured data into a computer is to type it directly into a text file. Simply fire up your favorite CSV editor1, sit down with your source material and start typing. Unlike boutique database software, this method can be used immediately and with minimal training. In fact, I know several researchers who skip paper forms altogether and do it during their field interviews.
Plaintext data entry works great, unless the data are hierarchical. I’m thinking of one of three situations:">
  <meta itemprop="datePublished" content="2017-02-12T00:00:00+00:00">
  <meta itemprop="dateModified" content="2017-02-12T00:00:00+00:00">
  <meta itemprop="wordCount" content="1050">
  <meta itemprop="image" content="/images/bret-head.jpg">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <link rel="stylesheet" href="/css/custom.css">
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



      <script async src="https://www.googletagmanager.com/gtag/js?id=G-4PXGB1H7X2"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-4PXGB1H7X2');
        }
      </script>

<script>
 
(function () {
  const KEY = "theme";
  const stored = localStorage.getItem(KEY);
  const systemDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
  const theme = stored || (systemDark ? "dark" : "light");
  document.documentElement.setAttribute("data-theme", theme);
  
  document.documentElement.style.colorScheme = theme === "dark" ? "dark" : "light";
})();
</script>

<style>
   
  :root {
    --bg: #ffffff;
    --fg: #1a1a1a;
    --muted: #666666;
    --link: #0b5fff;
    --card: #f6f7f9;
    --border: #e6e8eb;

     
    --link-visited: #5a8cff;
    --code-bg: #f5f3ff;
    --code-fg: #222222;
  }
  
  html[data-theme="dark"] {
    --bg: #0e1113;
    --fg: #e6e6e6;
    --muted: #a0a0a0;
    --link: #8ab4ff;
    --card: #171a20;
    --border: #2a2f3a;

    --link-visited: #a3c2ff;
    --code-bg: #1c1a28;
    --code-fg: #e6e6e6;
  }

   
  @media (prefers-color-scheme: dark) {
    html:not([data-theme]) {
      --bg: #0e0f12;
      --fg: #e6e6e6;
      --muted: #a0a0a0;
      --link: #8ab4ff;
      --card: #171a20;
      --border: #2a2f3a;

      --link-visited: #a3c2ff;
      --code-bg: #1c1a28;
      --code-fg: #e6e6e6;
    }
  }
</style>


</head>

<body>
  <header><a href="/" class="title">
  <h2>Bret Alexander Beheim</h2>
</a>
<nav>
  <div class="nav-links"><a href="/">About</a>

<a href="/publications.html">Publications</a>

<a href="/people.html">People</a>

<a href="/software.html">Software</a>

<a href="/teaching.html">Teaching</a>

<a href="/blog">Blog</a>

</div>
  <div class="nav-toggle">
    
<label class="switch" aria-label="Toggle dark mode" title="Toggle dark mode">
  <input id="theme-toggle" type="checkbox">
  <span class="slider round"></span>
</label>

<style>
 
.switch {
  position: relative;
  display: inline-block;
  width: 50px;    
  height: 26px;
  vertical-align: middle;  
}

 
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

 

 
.slider {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background-color: #242424;
  transition: .4s;
}

 
.slider:before {
  content: "";
  position: absolute;
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background-color: #e3e3e3;
  transition: .4s;
}

input:checked + .slider { background-color: #e3e3e3; }
input:checked + .slider:before { background-color: #242424; transform: translateX(24px); }

 
.slider.round { border-radius: 26px; }
.slider.round:before { border-radius: 50%; }
</style>
  </div>
</nav>

<style>
nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
</style></header>
  <main>

<h1>Capturing Hierarchical Data in Plain Text</h1>
<p>
  <i>
    <time datetime='2017-02-12' pubdate>
      12 February, 2017
    </time>
  </i>
</p>

<content>
  <p>A practical method of entering structured data into a computer is to type it directly into a text file. Simply fire up your favorite CSV editor<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, sit down with your source material and start typing. Unlike boutique database software, this method can be used immediately and with minimal training. In fact, I know several researchers who skip paper forms altogether and do it <em>during</em> their field interviews.</p>
<p>Plaintext data entry works great, unless the data are hierarchical. I’m thinking of one of three situations:</p>
<ol>
<li>A question might have multiple answers, e.g. “What did you buy at the store today?”, “Who are your closest friends?”, “What fish did you catch?”</li>
<li>A set of questions are to be grouped together as repeating sub-components, e.g. a list of recent trips might include columns called “outbound destination”, “outbound travel time”, “outbound start time”, “outbound average speed”, etc. with “inbound” equivalents.</li>
<li>A set of questions basically describe a complete subtable e.g. a household interview that asks for a list of residents, including name, age, sex, etc. Here there are both a variable number of ‘entities’ (as in 1) and each ‘entity’ has repeated sub-components (as in 2).</li>
</ol>
<p>Hierarchical data ultimately should be put into a relational database with a normalized schema. Programs like Microsoft Access or Filemaker can do this, but these both require money, specialized training and time to set up for each project. They also require a defined schema known before data is collected, which is optimistic.</p>
<p>A plaintext approach can work, but the existing solutions are usually unsatisfactory. A common fix is to create sets of repeating columns, e.g. in a household census file having <code>resident1_name</code>, <code>resident1_age</code>, <code>resident1_sex</code>, <code>resident2_name</code>, &hellip;, etc in a wide format. This leads to ugly, mostly empty tables that require substantial reshaping for data normalization.</p>
<p>Recently I’ve been playing with the idea of <em>typing into a data interchange format</em>. Unlike wide-form tables, these formats were <em>designed</em> to store structured data in plain text so it could pass from place to place, e.g. from a web server to a broswer.</p>
<p>So the idea, then, is you’d type each interview into a text file using an interchange format, then use standard parsing tools<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> to pull them into a relational database.</p>
<p>The first format I tried is Javascript Object Notation (JSON), whose syntax is defined by <a href="http://www.json.org">five elegant diagrams</a>. For example, in building a database of 19th-century scientists, a JSON record might look like so:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;name&#34;: <span style="color:#a31515">&#34;Charles Robert Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>  &#34;sex&#34;: <span style="color:#a31515">&#34;male&#34;</span>,
</span></span><span style="display:flex;"><span>  &#34;dob&#34;: <span style="color:#a31515">&#34;1809-02-12&#34;</span>,
</span></span><span style="display:flex;"><span>  &#34;dod&#34;: <span style="color:#a31515">&#34;1882-04-19&#34;</span>,
</span></span><span style="display:flex;"><span>  &#34;nationality&#34;: <span style="color:#a31515">&#34;British&#34;</span>,
</span></span><span style="display:flex;"><span>  &#34;spouses&#34;: <span style="color:#a31515">&#34;Emma Wedgwood&#34;</span>,
</span></span><span style="display:flex;"><span>  &#34;children&#34;: [
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;William Erasmus Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Anne Elizabeth Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Mary Eleanor Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Henrietta Emma Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;George Howard Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Elizabeth Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Francis Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Leonard Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Horace Darwin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a31515">&#34;Charles Waring Darwin&#34;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  &#34;published works&#34;: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;name&#34;: <span style="color:#a31515">&#34;On the Origin of Species by Means of Natural Selection, or the Preservation of Favoured Races in the Struggle for Life&#34;</span>,
</span></span><span style="display:flex;"><span>      &#34;year&#34;: <span style="color:#a31515">&#34;1859&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;name&#34;: <span style="color:#a31515">&#34;The Descent of Man, and Selection in Relation to Sex&#34;</span>,
</span></span><span style="display:flex;"><span>      &#34;year&#34;: <span style="color:#a31515">&#34;1871&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;name&#34;: <span style="color:#a31515">&#34;The Expression of the Emotions in Man and Animals&#34;</span>,
</span></span><span style="display:flex;"><span>      &#34;year&#34;: <span style="color:#a31515">&#34;1872&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>JSON syntax is organized around three concepts:</p>
<ul>
<li>An <strong>object</strong> is an unordered set of name/value pairs. Each name is followed by a colon, and the name/value pairs are separated by commas. The object itself is enclosed by curly brackets ( { } ).</li>
<li>An <strong>array</strong> is an ordered collection of values, enclosed by square brackets ( [ ] ). The values are separated by commas.</li>
<li>A <strong>value</strong> can be a string in double quotes, or a number, or true or false or null, or a JSON object or array.</li>
</ul>
<p>The language allows arbitrarily complex hierarchies because JSON values can include other JSON objects or arrays.</p>
<p>However, looking at the example above, you can see that JSON is not really right for manual data entry, especially in a real time interview. Lots of quotation marks, braces, brackets, and commas have to be done <em>exactly</em> right, or else it won’t parse properly.</p>
<p>Enter <a href="yaml.org">YAML</a>, a simplified sister format intended for direct human editing. For example, the above in YAML would be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  name: Charles Robert Darwin
</span></span><span style="display:flex;"><span>  sex: male
</span></span><span style="display:flex;"><span>  dob: 1809-02-12
</span></span><span style="display:flex;"><span>  dod: 1882-04-19
</span></span><span style="display:flex;"><span>  nationality: British
</span></span><span style="display:flex;"><span>  spouses: Emma Wedgwood
</span></span><span style="display:flex;"><span>  children:
</span></span><span style="display:flex;"><span>  - William Erasmus Darwin
</span></span><span style="display:flex;"><span>  - Anne Elizabeth Darwin
</span></span><span style="display:flex;"><span>  - Mary Eleanor Darwin
</span></span><span style="display:flex;"><span>  - Henrietta Emma Darwin
</span></span><span style="display:flex;"><span>  - George Howard Darwin
</span></span><span style="display:flex;"><span>  - Elizabeth Darwin
</span></span><span style="display:flex;"><span>  - Francis Darwin
</span></span><span style="display:flex;"><span>  - Leonard Darwin
</span></span><span style="display:flex;"><span>  - Horace Darwin
</span></span><span style="display:flex;"><span>  - Charles Waring Darwin
</span></span><span style="display:flex;"><span>  published works:
</span></span><span style="display:flex;"><span>  - name: <span style="color:#00f">On</span> the Origin of Species by Means of Natural Selection, or the Preservation
</span></span><span style="display:flex;"><span>      of Favoured Races in the Struggle for Life
</span></span><span style="display:flex;"><span>    year: 1859
</span></span><span style="display:flex;"><span>  - name: The Descent of Man, and Selection in Relation to Sex
</span></span><span style="display:flex;"><span>    year: 1871
</span></span><span style="display:flex;"><span>  - name: The Expression of the Emotions in Man and Animals
</span></span><span style="display:flex;"><span>    year: 1872
</span></span></code></pre></div><p>YAML’s syntax replaces almost all the JSON markup with clever line breaks and indentations in readible, logical ways. Moreover, <a href="https://www.json2yaml.com">any valid JSON can be written as YAML.</a>, so converting between the two is not hard.</p>
<p>The cost of this is fragility; unlike JSON, YAML depends on <em>exact</em> indentation, and some programs (e.g. Notepad.exe) will try to reformat your files.<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<p>Does this mean you can simply do away with relational databases altogether? It’s probably a terrible idea.<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> The goal, rather, is to send the data into a suitable heirarchical database. So my current pipeline is:</p>
<ol>
<li>Type the interview data into YAML.</li>
<li>Automatically convert this into JSON for archiving.</li>
<li>Parse the JSON files into a relational database using R scripts.</li>
</ol>
<p>That’s all.</p>
<h2 id="endnotes">Endnotes</h2>
<hr>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Excel is ubiquitous, and the spreadsheet structure makes it easier to type with your eyes off the screen. Free alternatives include OpenOffice and Comma Cameleon. However, provided you are careful with formatting, there’s nothing stopping you from filling out a CSV table directly in a text editor, e.g. Notepad++ (windows) and Sublime Text (OSX / Linux). The latter program is also interesting because it uses JSON to store all user settings.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>For R users, the library <code>JSONlite</code> provides a <code>readJSON</code> function which works well. The <code>yaml</code> library provides similar functions, but JSON is better for storage.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Specifically, if you open a non-Windows text file in Notepad it will not detect the Linux/Mac standard line break, creating a single-line document. Since YAML depends on exact line breaks, it can become unreadible, but JSON does not have this problem.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>as outlined by one developer’s hard-earned experience <a href="http://www.sarahmei.com/blog/2013/11/11/why-you-should-never-use-mongodb/">here</a>.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</content>
<p>
  
</p>

    
  </main>
  <footer>


<script>
(function () {
  const KEY = "theme";
  const el = document.getElementById("theme-toggle");
  if (!el) return;

  const getTheme = () => document.documentElement.getAttribute("data-theme") || "light";
  const setTheme = (t) => {
    document.documentElement.setAttribute("data-theme", t);
    document.documentElement.style.colorScheme = t === "dark" ? "dark" : "light";
    localStorage.setItem(KEY, t);
  };

  
  el.checked = getTheme() === "dark";

  
  el.addEventListener("change", () => setTheme(el.checked ? "dark" : "light"));

  
  
  const stored = localStorage.getItem(KEY);
  if (!stored && window.matchMedia) {
    const mq = window.matchMedia("(prefers-color-scheme: dark)");
    mq.addEventListener?.("change", (e) => {
      setTheme(e.matches ? "dark" : "light");
      el.checked = e.matches;
    });
  }
})();
</script>
</footer>

    
</body>

</html>
